import{_ as z,r as n,o as P,a4 as O,S as b,c as k,b as d,m as c,u as o,i as $,a7 as q,h,a as i,t as H,k as A,v as B,F as W,d as X,s as S,j as x,A as Y,q as G,D as J,a8 as K,a6 as Q}from"./index-qTY0cfte.js";/* empty css                        */const Z={class:"right_con"},ee={class:"now_con"},te={class:"now_txt"},ae={class:"now_top"},oe={class:"now_top"},le=["src"],se={class:"now_btn"},ne={key:1,style:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},ie={class:"phone_con"},re={class:"con_img"},ce={style:{width:"200px"}},de={__name:"index",setup(ue){n("");let C=n({}),v=n("one"),p=n([]),E=n([]),D=n(""),m=n(null),_=n(!0),V=n(""),f=n(null);P(()=>{F()}),O(()=>{m.value?(m.value.getTracks().forEach(t=>t.stop()),m.value=null,console.log("摄像头已关闭")):console.log("没有打开的摄像头")});let L=t=>{D.value=t},M=(t,e,u,g)=>{const a=t.split(","),l=a[0].match(/:(.*?);/)[1],r=atob(a[1]),w=r.length,s=new Uint8Array(w);for(let y=0;y<w;y++)s[y]=r.charCodeAt(y);const R=new Blob([s],{type:l});return new File([R],e,{type:u,lastModified:g})},U=t=>{console.log(C.value);const e=new FormData;if(e.append("zjh",C.value.zjh),t==2){e.append("iftgflag","0");const u="application/x-zip-compressed",g=Date.now();let a=E.value.map((l,r)=>M(l.image,r+"图片",u,g));console.log(a),a.forEach((l,r)=>{e.append("files",l,l.name)})}else e.append("iftgflag","1");console.log(e)},j=(t,e)=>{console.log(t,e)},F=async()=>{console.log(123);try{console.log("摄像头已打开"),I()}catch(t){console.error("打开摄像头失败:",t)}},I=async()=>{const t={video:{width:1280,height:960}};try{m.value=await navigator.mediaDevices.getUserMedia(t),f.value&&(f.value.srcObject=m.value)}catch(e){e.name==="PermissionDeniedError"?b.error("浏览器调用摄像头失败，浏览器没有调用摄像头的权限，建议使用google浏览器访问"):b.error("获取摄像头失败："+e.message)}},T=t=>{if(t==1)console.log("重拍"),_.value=!0,p.value.splice(D.value,1);else if(t==2){if(console.log("继续拍照"),p.value.length>=5)return b.warning("最多上传5张照片");_.value=!0}},N=()=>{if(p.value.length>=5)return b.warning("最多上传5张照片");let t=f.value;console.log(t),t.setAttribute("crossOrigin","anonymous");let e=document.createElement("canvas"),u=598/1280,g=440/960;e.width=t.videoWidth*u,e.height=t.videoHeight*g,e.getContext("2d").drawImage(t,0,0,e.width,e.height);let a=e.toDataURL("image/png"),l=[];l.push({time:new Date().toLocaleString(),image:a.split(",")[1]}),E.value.push({time:new Date().toLocaleString(),image:a}),l.forEach(r=>{p.value.push(r.image)}),_.value=!1};return(t,e)=>{const u=Y,g=G,a=J,l=K,r=Q,w=q;return h(),k("div",Z,[d(w,{modelValue:o(v),"onUpdate:modelValue":e[3]||(e[3]=s=>$(v)?v.value=s:v=s),onTabClick:o(j)},{default:c(()=>[d(l,{label:"实时拍照",name:"one"},{default:c(()=>[i("div",ee,[i("div",te,H(o(p).length)+"/5",1),A(i("div",ae,[i("video",{id:"v",autoplay:"true",ref_key:"video",ref:f,width:"598px",height:"440px"},null,512)],512),[[B,o(_)]]),A(i("div",oe,[d(g,{interval:5e3,arrow:"always",trigger:"click",onChange:o(L),style:{width:"598px",height:"440px"}},{default:c(()=>[(h(!0),k(W,null,X(o(p),s=>(h(),S(u,{key:s,style:{height:"440px"}},{default:c(()=>[i("img",{src:"data:image/png;base64,"+s,alt:"",style:{width:"100%",height:"440px"}},null,8,le)]),_:2},1024))),128))]),_:1},8,["onChange"])],512),[[B,!o(_)]]),i("div",se,[o(_)?(h(),S(a,{key:0,type:"primary",onClick:o(N),style:{width:"100%"}},{default:c(()=>[x("拍照")]),_:1},8,["onClick"])):(h(),k("div",ne,[d(a,{type:"primary",onClick:e[0]||(e[0]=s=>o(T)(1))},{default:c(()=>[x("重拍")]),_:1}),d(a,{type:"primary",onClick:e[1]||(e[1]=s=>o(T)(2))},{default:c(()=>[x("继续拍照")]),_:1})]))])])]),_:1}),d(l,{label:"手机扫码",name:"two"},{default:c(()=>[i("div",ie,[i("div",re,[d(r,{src:"data:image/png;base64,"+o(V)},null,8,["src"])]),i("div",ce,[d(a,{type:"primary",onClick:e[2]||(e[2]=s=>o(U)(1)),style:{width:"100%"}},{default:c(()=>[x("跳过")]),_:1})])])]),_:1})]),_:1},8,["modelValue","onTabClick"])])}}},_e=z(de,[["__scopeId","data-v-98d3716f"]]);export{_e as default};
